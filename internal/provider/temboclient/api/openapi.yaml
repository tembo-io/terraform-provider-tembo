openapi: 3.0.3
info:
  description: Platform API for Tembo Cloud
  title: Tembo Cloud
  version: v1.0.0-alpha
servers:
- url: /
security:
- jwt_token: []
paths:
  /api/v1/orgs/instances/schema:
    get:
      description: |
        Get the json-schema for an instance
      operationId: get_schema
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: json-schema for a Tembo Instance
        "401":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Unauthorized
      summary: Get the json-schema for an instance
      tags:
      - instance
  /api/v1/orgs/{org_id}/instances:
    get:
      description: |
        Get all Tembo instances in an organization
      operationId: get_all
      parameters:
      - description: organization id for the request
        explode: false
        in: path
        name: org_id
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/Instance'
                type: array
          description: All instances in your org
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid org_id
        "401":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Unauthorized
        "403":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Forbidden
      summary: Get all Tembo instances in an organization
      tags:
      - instance
    post:
      description: |
        Create a new Tembo instance
      operationId: create_instance
      parameters:
      - description: Organization ID that owns the Tembo instance
        explode: false
        in: path
        name: org_id
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInstance'
        required: true
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instance'
          description: Creating new Tembo instance
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid request parameters
        "401":
          content:
            text/plain:
              schema:
                type: string
          description: Unauthorized
        "403":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Forbidden
        "409":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Naming conflict
      summary: Create a new Tembo instance
      tags:
      - instance
  /api/v1/orgs/{org_id}/instances/{instance_id}:
    delete:
      description: |
        Delete an existing Tembo instance
      operationId: delete_instance
      parameters:
      - description: Organization id of the instance to delete
        explode: false
        in: path
        name: org_id
        required: true
        schema:
          type: string
        style: simple
      - description: Delete this instance id
        explode: false
        in: path
        name: instance_id
        required: true
        schema:
          type: string
        style: simple
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instance'
          description: Deleting instance
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid request parameters
        "401":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Unauthorized
        "403":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Forbidden
        "409":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid state transition
      summary: Delete an existing Tembo instance
      tags:
      - instance
    get:
      description: |
        Get an existing Tembo instance
      operationId: get_instance
      parameters:
      - description: Organization ID that owns the instance
        explode: false
        in: path
        name: org_id
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: path
        name: instance_id
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instance'
          description: The requested Tembo instance
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid org_id
        "401":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Unauthorized
        "403":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Forbidden
      summary: Get an existing Tembo instance
      tags:
      - instance
    patch:
      description: |
        Update attributes on an existing Tembo instance
      operationId: patch_instance
      parameters:
      - description: Organization ID that owns the instance
        explode: false
        in: path
        name: org_id
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: path
        name: instance_id
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchInstance'
        required: true
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instance'
          description: Updating attributes on the instance
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid request parameters
        "401":
          content:
            text/plain:
              schema:
                type: string
          description: Unauthorized
        "403":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Forbidden
        "409":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid state transition
      summary: Update attributes on an existing Tembo instance
      tags:
      - instance
    post:
      description: |-
        Lifecycle events for a Tembo instance

        Currently only supports restart
      operationId: instance_event
      parameters:
      - description: Organization ID that owns the Tembo instance
        explode: false
        in: path
        name: org_id
        required: true
        schema:
          type: string
        style: simple
      - explode: true
        in: query
        name: event_type
        required: true
        schema:
          $ref: '#/components/schemas/InstanceEvent'
        style: form
      - explode: false
        in: path
        name: instance_id
        required: true
        schema:
          type: string
        style: simple
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instance'
          description: Replace the attributes of the Tembo instance
        "401":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Unauthorized
        "403":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Forbidden
        "409":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid state transition
      summary: Lifecycle events for a Tembo instance
      tags:
      - instance
    put:
      description: |
        Replace all attributes of an existing Tembo instance
      operationId: put_instance
      parameters:
      - description: Organization ID that owns the Tembo instance
        explode: false
        in: path
        name: org_id
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: path
        name: instance_id
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateInstance'
        required: true
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instance'
          description: Replace the attributes of the Tembo instance
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid request parameters
        "401":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Unauthorized
        "403":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Forbidden
        "409":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Invalid state transition
      summary: Replace all attributes of an existing Tembo instance
      tags:
      - instance
  /api/v1/stacks:
    get:
      description: |
        Attributes for all stacks
      operationId: get_all_entities
      responses:
        "200":
          content:
            application/json:
              schema:
                items: {}
                type: array
          description: Stack specification represented as JSON
        "401":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Unauthorized
      summary: Attributes for all stacks
      tags:
      - stack
  /api/v1/stacks/{type}:
    get:
      description: |
        Get the attributes of a single stack
      operationId: get_entity
      parameters:
      - description: the type of entity
        example: standard
        explode: false
        in: path
        name: type
        required: true
        schema:
          $ref: '#/components/schemas/EntityType'
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Specification of the entity
        "400":
          content:
            application/json:
              schema: {}
          description: Invalid Stack
        "401":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseSchema'
          description: Unauthorized
      summary: Get the attributes of a single stack
      tags:
      - stack
components:
  schemas:
    CloudProvider:
      enum:
      - aws
      type: string
    ConnectionInfo:
      properties:
        host:
          type: string
        password:
          type: string
        port:
          format: int32
          type: integer
        user:
          type: string
      required:
      - host
      - password
      - port
      - user
      type: object
    Cpu:
      enum:
      - "1"
      - "2"
      - "4"
      - "8"
      - "16"
      - "32"
      type: string
    CreateCluster:
      properties:
        cpu:
          $ref: '#/components/schemas/Cpu'
        entity_properties:
          nullable: true
        entity_type:
          $ref: '#/components/schemas/EntityType'
        environment:
          $ref: '#/components/schemas/Environment'
        extra_domains_rw:
          items:
            type: string
          nullable: true
          type: array
        instance_name:
          type: string
        memory:
          $ref: '#/components/schemas/Memory'
        organization_id:
          nullable: true
          type: string
        postgres_configs:
          items:
            $ref: '#/components/schemas/PgConfig'
          nullable: true
          type: array
        replicas:
          allOf:
          - $ref: '#/components/schemas/Replicas'
          nullable: true
        storage:
          $ref: '#/components/schemas/Storage'
      required:
      - cpu
      - environment
      - instance_name
      - memory
      - storage
      type: object
    CreateInstance:
      example:
        environment: null
        extensions:
        - name: name
          description: description
          locations:
          - schema: schema
            database: database
            version: version
            enabled: true
          - schema: schema
            database: database
            version: version
            enabled: true
        - name: name
          description: description
          locations:
          - schema: schema
            database: database
            version: version
            enabled: true
          - schema: schema
            database: database
            version: version
            enabled: true
        extra_domains_rw:
        - extra_domains_rw
        - extra_domains_rw
        instance_name: instance_name
        memory: null
        stack_type: null
        postgres_configs:
        - name: name
          value: value
        - name: name
          value: value
        replicas: 0
        trunk_installs:
        - name: name
          version: version
        - name: name
          version: version
        cpu: null
        storage: null
      properties:
        cpu:
          $ref: '#/components/schemas/Cpu'
        environment:
          $ref: '#/components/schemas/Environment'
        extensions:
          items:
            $ref: '#/components/schemas/Extension'
          nullable: true
          type: array
        extra_domains_rw:
          items:
            type: string
          nullable: true
          type: array
        instance_name:
          type: string
        memory:
          $ref: '#/components/schemas/Memory'
        postgres_configs:
          items:
            $ref: '#/components/schemas/PgConfig'
          nullable: true
          type: array
        replicas:
          format: int32
          type: integer
        stack_type:
          $ref: '#/components/schemas/EntityType'
        storage:
          $ref: '#/components/schemas/Storage'
        trunk_installs:
          items:
            $ref: '#/components/schemas/TrunkInstall'
          nullable: true
          type: array
      required:
      - cpu
      - environment
      - instance_name
      - memory
      - stack_type
      - storage
      type: object
    EntityType:
      enum:
      - Standard
      - MessageQueue
      - MachineLearning
      - OLAP
      - OLTP
      type: string
    Environment:
      enum:
      - dev
      - test
      - prod
      type: string
    ErrorResponseSchema:
      example:
        error: error
      properties:
        error:
          type: string
      required:
      - error
      type: object
    Extension:
      example:
        name: name
        description: description
        locations:
        - schema: schema
          database: database
          version: version
          enabled: true
        - schema: schema
          database: database
          version: version
          enabled: true
      properties:
        description:
          nullable: true
          type: string
        locations:
          items:
            $ref: '#/components/schemas/ExtensionInstallLocation'
          type: array
        name:
          type: string
      required:
      - locations
      - name
      type: object
    ExtensionInstallLocation:
      example:
        schema: schema
        database: database
        version: version
        enabled: true
      properties:
        database:
          type: string
        enabled:
          type: boolean
        schema:
          nullable: true
          type: string
        version:
          nullable: true
          type: string
      required:
      - database
      - enabled
      type: object
    ExtensionInstallLocationStatus:
      example:
        error_message: error_message
        schema: schema
        database: database
        error: true
        version: version
        enabled: true
      properties:
        database:
          type: string
        enabled:
          nullable: true
          type: boolean
        error:
          nullable: true
          type: boolean
        error_message:
          nullable: true
          type: string
        schema:
          nullable: true
          type: string
        version:
          nullable: true
          type: string
      required:
      - database
      type: object
    ExtensionStatus:
      example:
        name: name
        description: description
        locations:
        - error_message: error_message
          schema: schema
          database: database
          error: true
          version: version
          enabled: true
        - error_message: error_message
          schema: schema
          database: database
          error: true
          version: version
          enabled: true
      properties:
        description:
          nullable: true
          type: string
        locations:
          items:
            $ref: '#/components/schemas/ExtensionInstallLocationStatus'
          type: array
        name:
          type: string
      required:
      - locations
      - name
      type: object
    Infrastructure:
      properties:
        cpu:
          $ref: '#/components/schemas/Cpu'
        instance_type:
          $ref: '#/components/schemas/InstanceTypes'
        memory:
          $ref: '#/components/schemas/Memory'
        provider:
          $ref: '#/components/schemas/CloudProvider'
        region:
          type: string
        storage_class:
          $ref: '#/components/schemas/StorageClass'
        storage_size:
          $ref: '#/components/schemas/Storage'
      required:
      - cpu
      - instance_type
      - memory
      - storage_class
      - storage_size
      type: object
    Instance:
      example:
        instance_name: instance_name
        memory: null
        replicas: 0
        cpu: null
        created_at: 2000-01-23T04:56:07.000+00:00
        organization_name: organization_name
        storage: null
        environment: null
        extensions:
        - name: name
          description: description
          locations:
          - error_message: error_message
            schema: schema
            database: database
            error: true
            version: version
            enabled: true
          - error_message: error_message
            schema: schema
            database: database
            error: true
            version: version
            enabled: true
        - name: name
          description: description
          locations:
          - error_message: error_message
            schema: schema
            database: database
            error: true
            version: version
            enabled: true
          - error_message: error_message
            schema: schema
            database: database
            error: true
            version: version
            enabled: true
        extra_domains_rw:
        - extra_domains_rw
        - extra_domains_rw
        instance_id: instance_id
        stack_type: null
        connection_info: ""
        last_updated_at: 2000-01-23T04:56:07.000+00:00
        postgres_configs:
        - name: name
          value: value
        - name: name
          value: value
        organization_id: organization_id
        trunk_installs:
        - error_message: error_message
          name: name
          error: true
          version: version
        - error_message: error_message
          name: name
          error: true
          version: version
        state: null
      properties:
        connection_info:
          allOf:
          - $ref: '#/components/schemas/ConnectionInfo'
          nullable: true
        cpu:
          $ref: '#/components/schemas/Cpu'
        created_at:
          format: date-time
          type: string
        environment:
          $ref: '#/components/schemas/Environment'
        extensions:
          items:
            $ref: '#/components/schemas/ExtensionStatus'
          nullable: true
          type: array
        extra_domains_rw:
          items:
            type: string
          nullable: true
          type: array
        instance_id:
          type: string
        instance_name:
          type: string
        last_updated_at:
          format: date-time
          type: string
        memory:
          $ref: '#/components/schemas/Memory'
        organization_id:
          type: string
        organization_name:
          type: string
        postgres_configs:
          items:
            $ref: '#/components/schemas/PgConfig'
          nullable: true
          type: array
        replicas:
          format: int32
          type: integer
        stack_type:
          $ref: '#/components/schemas/EntityType'
        state:
          $ref: '#/components/schemas/State'
        storage:
          $ref: '#/components/schemas/Storage'
        trunk_installs:
          items:
            $ref: '#/components/schemas/TrunkInstallStatus'
          nullable: true
          type: array
      required:
      - cpu
      - environment
      - instance_id
      - instance_name
      - memory
      - organization_id
      - organization_name
      - replicas
      - stack_type
      - state
      - storage
      type: object
    InstanceEvent:
      enum:
      - restart
      type: string
    InstanceTypes:
      enum:
      - GeneralPurpose
      type: string
    Memory:
      enum:
      - 1Gi
      - 2Gi
      - 4Gi
      - 8Gi
      - 16Gi
      - 32Gi
      type: string
    PatchInstance:
      example:
        environment: ""
        extensions:
        - name: name
          description: description
          locations:
          - schema: schema
            database: database
            version: version
            enabled: true
          - schema: schema
            database: database
            version: version
            enabled: true
        - name: name
          description: description
          locations:
          - schema: schema
            database: database
            version: version
            enabled: true
          - schema: schema
            database: database
            version: version
            enabled: true
        extra_domains_rw:
        - extra_domains_rw
        - extra_domains_rw
        memory: ""
        postgres_configs:
        - name: name
          value: value
        - name: name
          value: value
        replicas: ""
        trunk_installs:
        - name: name
          version: version
        - name: name
          version: version
        cpu: ""
        storage: ""
      properties:
        cpu:
          allOf:
          - $ref: '#/components/schemas/Cpu'
          nullable: true
        environment:
          allOf:
          - $ref: '#/components/schemas/Environment'
          nullable: true
        extensions:
          items:
            $ref: '#/components/schemas/Extension'
          nullable: true
          type: array
        extra_domains_rw:
          items:
            type: string
          nullable: true
          type: array
        memory:
          allOf:
          - $ref: '#/components/schemas/Memory'
          nullable: true
        postgres_configs:
          items:
            $ref: '#/components/schemas/PgConfig'
          nullable: true
          type: array
        replicas:
          allOf:
          - $ref: '#/components/schemas/Replicas'
          nullable: true
        storage:
          allOf:
          - $ref: '#/components/schemas/Storage'
          nullable: true
        trunk_installs:
          items:
            $ref: '#/components/schemas/TrunkInstall'
          nullable: true
          type: array
      type: object
    PgConfig:
      example:
        name: name
        value: value
      properties:
        name:
          type: string
        value:
          type: string
      required:
      - name
      - value
      type: object
    ReadCluster:
      properties:
        connection_info:
          allOf:
          - $ref: '#/components/schemas/ConnectionInfo'
          nullable: true
        cpu:
          allOf:
          - $ref: '#/components/schemas/Cpu'
          nullable: true
        created_at:
          format: date-time
          type: string
        entity_properties:
          nullable: true
        entity_type:
          $ref: '#/components/schemas/EntityType'
        environment:
          $ref: '#/components/schemas/Environment'
        extensions:
          items:
            $ref: '#/components/schemas/ExtensionStatus'
          nullable: true
          type: array
        extra_domains_rw:
          items:
            type: string
          nullable: true
          type: array
        instance_id:
          nullable: true
          type: string
        instance_name:
          type: string
        last_updated_at:
          format: date-time
          type: string
        memory:
          allOf:
          - $ref: '#/components/schemas/Memory'
          nullable: true
        organization_id:
          nullable: true
          type: string
        organization_name:
          nullable: true
          type: string
        replicas:
          allOf:
          - $ref: '#/components/schemas/Replicas'
          nullable: true
        state:
          allOf:
          - $ref: '#/components/schemas/State'
          nullable: true
        storage:
          allOf:
          - $ref: '#/components/schemas/Storage'
          nullable: true
        trunk_installs:
          items:
            $ref: '#/components/schemas/TrunkInstallStatus'
          nullable: true
          type: array
      required:
      - entity_type
      - environment
      - instance_name
      type: object
    Replicas:
      format: int32
      type: integer
    State:
      enum:
      - Submitted
      - Up
      - Configuring
      - Error
      - Restarting
      - Starting
      - Stopping
      - Stopped
      - Deleting
      - Deleted
      type: string
    Storage:
      enum:
      - 10Gi
      - 50Gi
      - 100Gi
      - 200Gi
      - 300Gi
      - 400Gi
      - 500Gi
      type: string
    StorageClass:
      enum:
      - gp3
      type: string
    TrunkInstall:
      example:
        name: name
        version: version
      properties:
        name:
          type: string
        version:
          nullable: true
          type: string
      required:
      - name
      type: object
    TrunkInstallStatus:
      example:
        error_message: error_message
        name: name
        error: true
        version: version
      properties:
        error:
          type: boolean
        error_message:
          nullable: true
          type: string
        name:
          type: string
        version:
          nullable: true
          type: string
      required:
      - error
      - name
      type: object
    UpdateCluster:
      properties:
        cpu:
          allOf:
          - $ref: '#/components/schemas/Cpu'
          nullable: true
        entity_properties:
          nullable: true
        environment:
          allOf:
          - $ref: '#/components/schemas/Environment'
          nullable: true
        extensions:
          items:
            $ref: '#/components/schemas/Extension'
          nullable: true
          type: array
        extra_domains_rw:
          items:
            type: string
          nullable: true
          type: array
        memory:
          allOf:
          - $ref: '#/components/schemas/Memory'
          nullable: true
        postgres_configs:
          items:
            $ref: '#/components/schemas/PgConfig'
          nullable: true
          type: array
        replicas:
          allOf:
          - $ref: '#/components/schemas/Replicas'
          nullable: true
        storage:
          allOf:
          - $ref: '#/components/schemas/Storage'
          nullable: true
        trunk_installs:
          items:
            $ref: '#/components/schemas/TrunkInstall'
          nullable: true
          type: array
      type: object
    UpdateInstance:
      example:
        environment: null
        extensions:
        - name: name
          description: description
          locations:
          - schema: schema
            database: database
            version: version
            enabled: true
          - schema: schema
            database: database
            version: version
            enabled: true
        - name: name
          description: description
          locations:
          - schema: schema
            database: database
            version: version
            enabled: true
          - schema: schema
            database: database
            version: version
            enabled: true
        extra_domains_rw:
        - extra_domains_rw
        - extra_domains_rw
        memory: null
        postgres_configs:
        - name: name
          value: value
        - name: name
          value: value
        replicas: 0
        trunk_installs:
        - name: name
          version: version
        - name: name
          version: version
        cpu: null
        storage: null
      properties:
        cpu:
          $ref: '#/components/schemas/Cpu'
        environment:
          $ref: '#/components/schemas/Environment'
        extensions:
          items:
            $ref: '#/components/schemas/Extension'
          nullable: true
          type: array
        extra_domains_rw:
          items:
            type: string
          nullable: true
          type: array
        memory:
          $ref: '#/components/schemas/Memory'
        postgres_configs:
          items:
            $ref: '#/components/schemas/PgConfig'
          nullable: true
          type: array
        replicas:
          format: int32
          type: integer
        storage:
          $ref: '#/components/schemas/Storage'
        trunk_installs:
          items:
            $ref: '#/components/schemas/TrunkInstall'
          nullable: true
          type: array
      required:
      - cpu
      - environment
      - memory
      - replicas
      - storage
      type: object
  securitySchemes:
    jwt_token:
      bearerFormat: JWT
      scheme: bearer
      type: http
